name: Appium Run CI

on:
  push:
    branches: [ "lp/apredendendo-CI/CD" ]
  pull_request:
    branches: [ "lp/apredendendo-CI/CD" ]

jobs:
    appium_test:
        runs-on: macos-latest

        steps:

        - name: Checkout
          uses: actions/checkout@v3

        - name: Configurar Node.js
          uses: actions/setup-node@v3
          with:
            node-version: '18'
            cache: 'npm'

        - name: Instalar dependÃªncias do projeto
          run: npm install

        - name: Configurar Android SDK
          run: chmod +x ./scripts/android-sdk.sh && ./scripts/android-sdk.sh

        - name: Iniciar Appium Server
          run: chmod +x ./scripts/appium-server.sh && ./scripts/appium-server.sh

        - name: Espera Appium Server
          run: sleep 8

        - name: Exportar as Variaveis necessarias
          run: export GITHUB_ACTIONS=true

        - name: Rode os testes do Appium
          uses: reactivecircus/android-emulator-runner@v2.28.0
          with:
            api-level: 33
            target: default
            arch: x86_64
            ram-size: 4096M
            heap-size: 1024M
            script: npm test
